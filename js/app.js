"use strict";function checkWidth(){$(document).width()>767?($(".accordion-toggle").attr("data-toggle",""),$(".panel-collapse").collapse("show")):($(".accordion-toggle").attr("data-toggle","collapse"),$(".panel-collapse").collapse("hide"))}var loc=window.location.href+"";0===loc.indexOf("http://askkaz")&&(window.location.href=loc.replace("http://","https://"));var offMapMarker={name:"No matching results....",latlng:new google.maps.LatLng(0,89)},markers=[{name:"Eden Center",lat:38.8736,lon:-77.1539},{name:"Manassas Battlefield Park",lat:38.8128,lon:-77.5217},{name:"Mount Vernon",lat:38.708987,lon:-77.086132},{name:"Reagan Airport",lat:38.8519,lon:-77.0377},{name:"The Pentagon",lat:38.871,lon:-77.056},{name:"The White House",lat:38.8977,lon:-77.0366},{name:"Udvar Hazy Center",lat:38.9114,lon:-77.4441},{name:"US Capitol",lat:38.8898,lon:-77.0091}];for(var marker in markers)markers.hasOwnProperty(marker)&&(markers[marker].latLng=new google.maps.LatLng(markers[marker].lat,markers[marker].lon));var map={},mapCenterLatitude=38.9,mapCenterLongitude=-77,userLat=38.78,userLon=-77.27,Place=function(e){var t=this;this.marker=new google.maps.Marker({position:e.latLng,title:e.name}),google.maps.event.addListener(this.marker,"click",function(){viewModel.switchPlace(t)}),this.price=ko.observable("Unavailable"),this.updating=ko.observable(!1),this.isSelected=ko.observable(!1),this.matchesSearch=ko.observable(!0)},Wiki=function(){var e=this;e.text=ko.observable(""),e.link=ko.observable("#")},ViewModel=function(){var e=this;this.wikiText=ko.observable(""),this.wikiLink=ko.observable(""),this.wikiInfo=ko.observable(new Wiki),this.searchInput=ko.observable(""),this.mapLatLng=new google.maps.LatLng(mapCenterLatitude,mapCenterLongitude),this.bounds=new google.maps.LatLngBounds,this.iWindow=new google.maps.InfoWindow({content:""}),this.userLatitude=ko.observable(userLat),this.userLongitude=ko.observable(userLon),this.userLatLng=new google.maps.LatLng(this.userLatitude(),this.userLongitude()),this.userPosition=new google.maps.Marker({position:e.userLatLng,title:"You are here",icon:"https://maps.google.com/mapfiles/arrow.png"}),google.maps.event.addListener(this.userPosition,"position_changed",function(){e.userLatitude(this.position.lat()),e.userLongitude(this.position.lng()),e.updatePrices()}),this.placeList=ko.observableArray([]),this.currentPlace=ko.observable(),markers.forEach(function(t){e.placeList.push(new Place(t)),e.bounds.extend(t.latLng)}),this.updateWiki=function(){var t="https://en.wikipedia.org/w/api.php?action=query&prop=extracts&exchars=300&explaintext&titles="+e.currentPlace().marker.title+"&format=json&redirects",a=setTimeout(function(){e.wikiInfo().text("Failed to get wiki resources"),e.wikiInfo().link("#")},8e3);$.ajax({url:t,dataType:"jsonp",success:function(t){var i=t.query.pages;for(var o in i)i.hasOwnProperty(o)&&(e.wikiInfo().text(i[o].extract),e.wikiInfo().link("http://en.wikipedia.org/?curid="+t.query.pages[o].pageid));clearTimeout(a)}})},this.switchPlace=function(t){e.currentPlace()&&e.currentPlace().isSelected(!1),e.currentPlace(t),e.iWindow.setContent(e.currentPlace().marker.title),e.iWindow.open(map,e.currentPlace().marker),e.currentPlace().isSelected(!0),e.updateWiki()},this.updatePrices=function(){e.placeList().forEach(function(t){t.price("Fetching..."),t.updating(!0);var a=setTimeout(function(){t.price("Unavailable"),t.updating(!1)},8e3);$.ajax({url:"https://api.uber.com/v1/estimates/price",headers:{Authorization:"Token guQmO5RBKDkuf8vWZWqlrfBS9mX635G4_frn7ekR"},data:{start_latitude:e.userLatitude(),start_longitude:e.userLongitude(),end_latitude:t.marker.position.lat(),end_longitude:t.marker.position.lng()},success:function(e){t.price(e.prices[0]?e.prices[0].estimate:"Unavailable"),t.updating(!1)},error:function(){t.price("Unavailable"),t.updating(!1)}}),clearTimeout(a)})},this.noPlace=new Place(offMapMarker),this.searchInput.subscribe(function(t){var a={},i=new RegExp("(^|\\s)"+t,"i");for(var o in e.placeList())e.placeList().hasOwnProperty(o)&&(i.exec(e.placeList()[o].marker.title)?(e.placeList()[o].matchesSearch(!0),e.placeList()[o].marker.setVisible(!0),a.marker||(a=e.placeList()[o])):(e.placeList()[o].matchesSearch(!1),e.placeList()[o].marker.setVisible(!1)));e.switchPlace(a.marker?a:e.noPlace)}),this.switchPlace(this.placeList()[2]),this.updatePrices()};ko.bindingHandlers.map={init:function(e,t,a,i){function o(e){p.setPosition(e)}var n=ko.utils.unwrapObservable(t()),r=[{featureType:"poi",elementType:"labels",stylers:[{visibility:"off"}]}],s={mapTypeId:google.maps.MapTypeId.ROADMAP,styles:r,streetViewControl:!1,mapTypeControl:!1,center:n.user.position,zoom:12,zoomControlOptions:{position:google.maps.ControlPosition.RIGHT_TOP}};map=new google.maps.Map(e,s),map.fitBounds(n.mapBounds),google.maps.event.addDomListener(window,"load",this);var l=ko.utils.unwrapObservable(n.places());for(var c in l)l.hasOwnProperty(c)&&l[c].marker.setMap(map);var p=ko.utils.unwrapObservable(n.user);p.setMap(map),google.maps.event.addListener(map,"click",function(e){o(e.latLng)})}};var viewModel=new ViewModel;ko.applyBindings(viewModel),$(window).resize(function(){checkWidth()}),$(document).ready(function(){checkWidth()});